<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <title>Prototype</title>
</head>

<body>
    <h2>WEB SPEECH API - PROTOTYPE</h2>
    <input id='txtInput' /> <br><br>
    <button id='btnSpeak'>Speak</button>
    <button id='btnTalk'>Talk</button>
    <br><br>
    <span id='message'></span>
    <script>
        // speech to text (Speech recognition)
        var message = document.querySelector('#message');

        var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
        var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList;

        var grammar = '#JSGF V1.0;'

        var recognition = new SpeechRecognition();
        var speechRecognitionList = new SpeechGrammarList();
        speechRecognitionList.addFromString(grammar, 1);
        recognition.grammars = speechRecognitionList;
        recognition.lang = 'en-US';
        recognition.interimResults = false;

        recognition.onresult = function (event) {
            var last = event.results.length - 1;
            var command = event.results[last][0].transcript;
            message.textContent = 'You spoke: ' + command;

            Math.eval = function (command) {
                if (command.startsWith("sine ") || command.startsWith("cosecant inverse ")) {
                    if (command.startsWith("sine ")) {
                        degree = command.substring(5, command.length);
                    } else {
                        degree = command.substring(16, command.length);
                    }
                    console.log(degree)
                    text.value = Math.sin(degree * Math.PI / 180).toFixed(5);
                } else if (command.startsWith("cosine") || command.startsWith("secant inverse ")) {
                    if (command.startsWith("cosine ")) {
                        degree = command.substring(7, command.length);
                    } else {
                        degree = command.substring(15, command.length);
                    }
                    text.value = Math.cos(degree * Math.PI / 180).toFixed(5);
                } else if (command.startsWith("tangent ") || command.startsWith("cotangent inverse ")) {
                    if (command.startsWith("tangent ")) {
                        degree = command.substring(7, command.length);
                    } else {
                        degree = command.substring(18, command.length);
                    }
                    text.value = Math.tan(degree * Math.PI / 180).toFixed(5);
                } else if (command.startsWith("secant ") || command.startsWith("cosine inverse ")) {
                    if (command.startsWith("secant ")) {
                        degree = command.substring(7, command.length);
                    } else {
                        degree = command.substring(14, command.length);
                    }
                    console.log(degree)
                    text.value = (1 / Math.sin(degree * Math.PI / 180)).toFixed(5);
                } else if (command.startsWith("cosecant ") || command.startsWith("sine inverse ")) {
                    if (command.startsWith("cosecant ")) {
                        degree = command.substring(9, command.length);
                    } else {
                        degree = command.substring(12, command.length);
                    }
                    text.value = (1 / Math.cos(degree * Math.PI / 180)).toFixed(5);
                } else if (command.startsWith("cotangent ") || command.startsWith("tangent inverse ")) {
                    if (command.startsWith("cotangent ")) {
                        degree = command.substring(10, command.length);
                    } else {
                        degree = command.substring(16, command.length);
                    }
                    text.value = (1 / Math.tan(degree * Math.PI / 180)).toFixed(5);
                } else if (command.startsWith("log ")) {
                    degree = command.substring(3, command.length);
                    text.value = Math.log(degree).toFixed(5);
                }
                else {
                    for (var i = 0; i < command.length; i++) {
                        if (isNaN(command[i]) && !['+', '-', '/', '*', '%'].includes(command[i])) {
                            text.value = "";
                            text.value = command;
                            return NaN;
                        } else {
                            text.value = eval(command);
                        }
                    }
                }

            }
            Math.eval(command);
            
            setTimeout(function () {
            console.log("Hiiiii")
            var toSpeak = new SpeechSynthesisUtterance(txtInput.value);
            synth.speak(toSpeak);
        }, 8000);
        };

        recognition.onspeechend = function () {
            recognition.stop();
        };

        recognition.onerror = function (event) {
            message.textContent = 'Error occurred in recognition: ' + event.error;
        }

        document.querySelector('#btnTalk').addEventListener('click', function () {
            recognition.start();

        });

        // text to speech (Speech Synthesis)
        var txtInput = document.querySelector('#txtInput');
        var btnSpeak = document.querySelector('#btnSpeak');
        var synth = window.speechSynthesis;

        setTimeout(function () {
            console.log("Hiiiii")
            var toSpeak = new SpeechSynthesisUtterance(txtInput.value);
            synth.speak(toSpeak);
        }, 8000);

        btnSpeak.addEventListener('click', () => {
            var toSpeak = new SpeechSynthesisUtterance(txtInput.value);
            synth.speak(toSpeak);
        });
    </script>
</body>
